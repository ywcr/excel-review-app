# ä»£ç æ”¹è¿›æ–¹æ¡ˆ

## ğŸ” å‘ç°çš„ä¸»è¦é—®é¢˜

### 1. ä¾èµ–ç®¡ç†é—®é¢˜
**é—®é¢˜**: `AutomationCodeGenerator` æ„é€ å‡½æ•°ä¸­ç›´æ¥åˆ›å»ºäº†5ä¸ªä¾èµ–å¯¹è±¡
```javascript
constructor(config) {
    this.config = config;
    this.templateManager = new TemplateManager();           // ç¡¬ä¾èµ–
    this.validationManager = new ValidationManager();       // ç¡¬ä¾èµ–
    this.executionLogicManager = new ExecutionLogicManager(); // ç¡¬ä¾èµ–
    this.controlPanelManager = new ControlPanelManager();   // ç¡¬ä¾èµ–
    this.questionnaireLogic = QuestionnaireLogicFactory.create(config.name); // ç¡¬ä¾èµ–
}
```

**å½±å“**: 
- éš¾ä»¥è¿›è¡Œå•å…ƒæµ‹è¯•
- æ— æ³•æ›¿æ¢ä¾èµ–å®ç°
- è¿åäº†ä¾èµ–å€’ç½®åŸåˆ™

### 2. æ¨¡æ¿é‡å¤é—®é¢˜
**é—®é¢˜**: APIå’ŒDOMæ¨¡æ¿æœ‰å¤§é‡é‡å¤å†…å®¹
```javascript
getApiAllDatesTemplate() {
    return this.getApiSingleTemplate()
        .replace('APIæ¨¡å¼è‡ªåŠ¨åŒ–æ‰§è¡Œä»£ç ï¼ˆå¢å¼ºç‰ˆï¼‰', 'APIæ¨¡å¼è‡ªåŠ¨åŒ–æ‰§è¡Œä»£ç ï¼ˆå…¨éƒ¨æ—¥æœŸï¼‰')
        .replace('åŒ…å«åŠŸèƒ½: è‡ªåŠ¨åŒ–åˆ›å»º + æ•°æ®éªŒè¯ + ç¼ºå¤±è¡¥å……', 'åŒ…å«åŠŸèƒ½: è‡ªåŠ¨åŒ–åˆ›å»º + æ•°æ®éªŒè¯ + æ—¥æœŸåˆ‡æ¢');
}
```

**å½±å“**:
- ç»´æŠ¤å›°éš¾
- å®¹æ˜“å‡ºé”™
- ä»£ç å†—ä½™

### 3. èŒè´£æ··ä¹±é—®é¢˜
**é—®é¢˜**: æŸäº›ç±»æ‰¿æ‹…äº†è¿‡å¤šèŒè´£
- `BaseQuestionnaire` æ—¢ç®¡ç†é—®å·é€»è¾‘ï¼Œåˆç®¡ç†è”ç³»äººåˆ›å»ºï¼Œè¿˜ç®¡ç†åŒ»é™¢åˆ›å»º
- `AutomationCodeGenerator` æ—¢ç”Ÿæˆä»£ç ï¼Œåˆè´Ÿè´£å¤åˆ¶åˆ°å‰ªè´´æ¿

## ğŸ› ï¸ å…·ä½“æ”¹è¿›æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: ä¾èµ–æ³¨å…¥é‡æ„

åˆ›å»ºä¾èµ–æ³¨å…¥å®¹å™¨ï¼š
```javascript
// æ–°å»º html/js/automation/dependency-container.js
class DependencyContainer {
    constructor() {
        this.dependencies = new Map();
        this.singletons = new Map();
    }
    
    register(name, factory, singleton = false) {
        this.dependencies.set(name, { factory, singleton });
    }
    
    resolve(name) {
        const dep = this.dependencies.get(name);
        if (!dep) throw new Error(`Dependency not found: ${name}`);
        
        if (dep.singleton) {
            if (!this.singletons.has(name)) {
                this.singletons.set(name, dep.factory(this));
            }
            return this.singletons.get(name);
        }
        
        return dep.factory(this);
    }
}

// é…ç½®ä¾èµ–
const container = new DependencyContainer();
container.register('templateManager', () => new TemplateManager(), true);
container.register('validationManager', () => new ValidationManager(), true);
container.register('executionLogicManager', () => new ExecutionLogicManager(), true);
container.register('controlPanelManager', () => new ControlPanelManager(), true);
```

é‡æ„ä»£ç ç”Ÿæˆå™¨ï¼š
```javascript
class AutomationCodeGenerator {
    constructor(config, container = null) {
        this.config = config;
        this.container = container || new DependencyContainer();
        
        // å»¶è¿ŸåŠ è½½ä¾èµ–
        this._templateManager = null;
        this._validationManager = null;
        this._executionLogicManager = null;
        this._controlPanelManager = null;
        this._questionnaireLogic = null;
    }
    
    get templateManager() {
        if (!this._templateManager) {
            this._templateManager = this.container.resolve('templateManager');
        }
        return this._templateManager;
    }
    
    // å…¶ä»–ä¾èµ–ç±»ä¼¼å¤„ç†...
}
```

### æ–¹æ¡ˆ2: æ¨¡æ¿ç³»ç»Ÿé‡æ„

åˆ›å»ºæ¨¡æ¿åŸºç±»å’Œæ‰©å±•ï¼š
```javascript
// æ–°å»º html/js/automation/template-base.js
class TemplateBase {
    constructor() {
        this.placeholders = new Set();
    }
    
    getBaseTemplate() {
        return `
// ==================== {{MODE}}æ¨¡å¼è‡ªåŠ¨åŒ–æ‰§è¡Œä»£ç {{TYPE_SUFFIX}} ====================
// æ‰§è¡Œäºº: {{ASSIGNEE}}
{{DATE_COMMENT}}
// åŒ…å«åŠŸèƒ½: {{FEATURES}}

const data = {{DATA}};
const config = {{CONFIG}};
const hasChannel = {{HAS_CHANNEL}};

console.log("æ•°æ®åŠ è½½å®Œæˆï¼Œå…±", data.length, "æ¡");

{{MODE_SPECIFIC_CONFIG}}

{{VALIDATION_CODE}}

{{MODE_SPECIFIC_FUNCTIONS}}

{{QUESTION_LOGIC}}

{{EXECUTION_LOGIC}}

{{STARTUP_MESSAGES}}

{{CONTROL_PANEL}}
`;
    }
    
    createTemplate(mode, type, features) {
        const template = this.getBaseTemplate();
        const replacements = this.getReplacements(mode, type, features);
        
        return this.applyReplacements(template, replacements);
    }
}

class DomTemplateExtension extends TemplateBase {
    getModeSpecificConfig() {
        return `
// DOMæ“ä½œç›¸å…³å˜é‡
const contentWindow = document.querySelector('#ssfwIframe')?.contentWindow ?? window;

// APIåŸºç¡€é…ç½®ï¼ˆç”¨äºéªŒè¯åŠŸèƒ½ï¼‰
const API_BASE_URL = window.location.origin;
`;
    }
    
    getModeSpecificFunctions() {
        return `
// è®¾ç½®è¾“å…¥æ¡†å€¼
function setInputValue(name, value) {
    // DOMæ“ä½œé€»è¾‘
}

// è®¾ç½®é€‰é¡¹å€¼  
function setOptionValue(index, values) {
    // DOMæ“ä½œé€»è¾‘
}
`;
    }
}
```

### æ–¹æ¡ˆ3: èŒè´£åˆ†ç¦»é‡æ„

æ‹†åˆ† `BaseQuestionnaire`ï¼š
```javascript
// æ–°å»º html/js/automation/questionnaire-logic/questionnaire-interface.js
class IQuestionnaire {
    getQuestionLogic() {
        throw new Error('Must implement getQuestionLogic');
    }
}

// æ–°å»º html/js/automation/contact-manager.js
class ContactManager {
    constructor(contactType) {
        this.contactType = contactType;
    }
    
    getContactCreationLogic() {
        // è”ç³»äººåˆ›å»ºé€»è¾‘
    }
}

// æ–°å»º html/js/automation/channel-manager.js
class ChannelManager {
    constructor(hasChannel) {
        this.hasChannel = hasChannel;
    }
    
    getChannelCreationLogic() {
        // åŒ»é™¢åˆ›å»ºé€»è¾‘
    }
}

// é‡æ„åçš„åŸºç±»
class BaseQuestionnaire extends IQuestionnaire {
    constructor(config) {
        super();
        this.config = config;
        this.contactManager = new ContactManager(config.contactType);
        this.channelManager = new ChannelManager(config.hasChannel);
    }
    
    getContactCreationLogic() {
        return this.contactManager.getContactCreationLogic();
    }
    
    getChannelCreationLogic() {
        return this.channelManager.getChannelCreationLogic();
    }
}
```

### æ–¹æ¡ˆ4: é…ç½®å¤–éƒ¨åŒ–

åˆ›å»ºé…ç½®ç®¡ç†å™¨ï¼š
```javascript
// æ–°å»º html/js/automation/config-manager.js
class ConfigManager {
    constructor() {
        this.configs = new Map();
        this.loadConfigs();
    }
    
    loadConfigs() {
        // ä»å¤–éƒ¨æ–‡ä»¶æˆ–APIåŠ è½½é…ç½®
        this.loadTemplateConfigs();
        this.loadValidationConfigs();
        this.loadExecutionConfigs();
    }
    
    getTemplateConfig(templateName) {
        return this.configs.get(`template.${templateName}`);
    }
    
    getValidationConfig() {
        return this.configs.get('validation');
    }
}
```

## ğŸ“‹ å®æ–½è®¡åˆ’

### é˜¶æ®µ1: ç«‹å³æ”¹è¿›ï¼ˆ1-2å¤©ï¼‰
1. âœ… è¡¥å……å…¶ä»–é—®å·ç±»å‹çš„é€»è¾‘å®ç°
2. âœ… ç»Ÿä¸€é”™è¯¯å¤„ç†æœºåˆ¶
3. âœ… æ·»åŠ è¾“å…¥å‚æ•°éªŒè¯

### é˜¶æ®µ2: ç»“æ„ä¼˜åŒ–ï¼ˆ3-5å¤©ï¼‰
1. ğŸ”„ å®æ–½ä¾èµ–æ³¨å…¥é‡æ„
2. ğŸ”„ é‡æ„æ¨¡æ¿ç³»ç»Ÿ
3. ğŸ”„ èŒè´£åˆ†ç¦»é‡æ„

### é˜¶æ®µ3: æ¶æ„å‡çº§ï¼ˆ1-2å‘¨ï¼‰
1. â³ é…ç½®å¤–éƒ¨åŒ–
2. â³ æ·»åŠ å•å…ƒæµ‹è¯•
3. â³ æ€§èƒ½ä¼˜åŒ–

## ğŸ¯ é¢„æœŸæ”¶ç›Š

### çŸ­æœŸæ”¶ç›Š
- ä»£ç æ›´æ˜“æµ‹è¯•
- ä¾èµ–å…³ç³»æ›´æ¸…æ™°
- æ¨¡æ¿ç»´æŠ¤æ›´ç®€å•

### é•¿æœŸæ”¶ç›Š
- ç³»ç»Ÿæ›´æ˜“æ‰©å±•
- é…ç½®æ›´çµæ´»
- ç»´æŠ¤æˆæœ¬æ›´ä½

## ğŸ¤” æ˜¯å¦éœ€è¦ç«‹å³å®æ–½ï¼Ÿ

**å»ºè®®**: 
1. **ç«‹å³å®æ–½é˜¶æ®µ1**: é£é™©ä½ï¼Œæ”¶ç›Šæ˜æ˜¾
2. **è¯„ä¼°åå®æ–½é˜¶æ®µ2**: éœ€è¦è€ƒè™‘å¼€å‘æ—¶é—´å’Œæµ‹è¯•æˆæœ¬
3. **è°¨æ…è€ƒè™‘é˜¶æ®µ3**: å¯èƒ½è¿‡åº¦è®¾è®¡ï¼Œéœ€è¦æ ¹æ®å®é™…éœ€æ±‚å†³å®š

å½“å‰é‡æ„å·²ç»è§£å†³äº†ä¸»è¦é—®é¢˜ï¼Œæ˜¯å¦è¿›ä¸€æ­¥ä¼˜åŒ–éœ€è¦æƒè¡¡æˆæœ¬å’Œæ”¶ç›Šã€‚
